var LiveSearch={searchBoxes:"",activeRequests:[],callbacks:[],addCallback:function(e,t){if(this.callbacks[e]===undefined){this.callbacks[e]=[]}return this.callbacks[e].push(t)},invokeCallbacks:function(e,t){var n;if(this.callbacks[e]!==undefined){for(n in this.callbacks[e]){t=this.callbacks[e][n](t)}}}};LiveSearch.init=function(){LiveSearch.searchBoxes=jQuery("input").filter("[name='s']").not(".no-livesearch");LiveSearch.searchBoxes.keyup(LiveSearch.handleKeypress);LiveSearch.searchBoxes.focus(LiveSearch.hideResults);if(!LiveSearch.searchBoxes.outerHeight){alert(DavesWordPressLiveSearchConfig.outdatedJQuery)}LiveSearch.searchBoxes.parents("form").attr("autocomplete","off");LiveSearch.searchBoxes.each(function(){this.autocomplete="off"});jQuery("html").click(LiveSearch.hideResults);LiveSearch.searchBoxes.click(function(e){e.stopPropagation()});LiveSearch.compiledResultTemplate=_.template(DavesWordPressLiveSearchConfig.resultTemplate);jQuery(window).resize(function(){LiveSearch.positionResults(this)})};LiveSearch.positionResults=function(){var e;var t=jQuery("input:focus").first();var n=jQuery("#dwls_search_results");if(n&&t.size()>0){var r=t.offset();r.left+=parseInt(DavesWordPressLiveSearchConfig.xOffset,10);r.top+=parseInt(DavesWordPressLiveSearchConfig.yOffset,10);n.css("left",r.left);n.css("top",r.top);n.css("width",t.outerWidth());n.css("display","block");switch(DavesWordPressLiveSearchConfig.resultsDirection){case"up":e=r.top-n.height();break;case"down":e=r.top+LiveSearch.searchBoxes.outerHeight();break;default:e=r.top+LiveSearch.searchBoxes.outerHeight()}n.css("top",e+"px")}};LiveSearch.handleAJAXResults=function(e){var t="";LiveSearch.activeRequests.pop();if(e){resultsSearchTerm=e.searchTerms;if(resultsSearchTerm!=jQuery("input:focus").first().val()){if(LiveSearch.activeRequests.length===0){LiveSearch.removeIndicator()}return}var n=jQuery("#dwls_search_results").children("input[name=query]").val();if(n!==""&&resultsSearchTerm==n){if(LiveSearch.activeRequests.length===0){LiveSearch.removeIndicator()}return}if(e.results.length===0){LiveSearch.hideResults()}else{t=LiveSearch.compiledResultTemplate({searchResults:e.results,e:e,resultsSearchTerm:resultsSearchTerm});var r=jQuery("#dwls_search_results");if(r.size()>0){jQuery("#dwls_search_results").replaceWith(t)}else{jQuery("body").append(t)}LiveSearch.positionResults();jQuery("#dwls_search_results").bind("click.dwls",function(){window.location.href=jQuery(this).find("a.daves-wordpress-live-search_title").attr("href")})}if(LiveSearch.activeRequests.length===0){LiveSearch.removeIndicator()}}};LiveSearch.handleKeypress=function(e){var t=0;var n=LiveSearch.searchBoxes.val();setTimeout(function(){LiveSearch.runQuery(n)},t)};LiveSearch.runQuery=function(e){var t=jQuery("input:focus");var n=t.val();var r;var i;if(n===""||n.length<DavesWordPressLiveSearchConfig.minCharsToSearch){LiveSearch.hideResults();LiveSearch.removeIndicator()}else{LiveSearch.displayIndicator();while(LiveSearch.activeRequests.length>0){i=LiveSearch.activeRequests.pop();i.abort()}var s={};var o=t.parents("form").find("input:not(:submit),select,textarea");for(r in o){if(o.hasOwnProperty(r)&&r%1===0){var u=jQuery(o[r]);s[u.attr("name")]=u.val()}}s.action="dwls_search";i=jQuery.get(DavesWordPressLiveSearchConfig.ajaxURL,s,LiveSearch.handleAJAXResults,"json");i.fail=LiveSearch.ajaxFailHandler;LiveSearch.activeRequests.push(i)}};LiveSearch.ajaxFailHandler=function(e){console.log("Dave's WordPress Live Search: There was an error retrieving or parsing search results");console.log("The data returned was:");console.log(e)};LiveSearch.hideResults=function(){var e=jQuery("#dwls_search_results");if(e.size()>0){LiveSearch.invokeCallbacks("BeforeHideResults");switch(DavesWordPressLiveSearchConfig.resultsDirection){case"up":e.fadeOut("normal",function(){e.remove();LiveSearch.invokeCallbacks("AfterHideResults")});break;case"down":e.slideUp("normal",function(){e.remove();LiveSearch.invokeCallbacks("AfterHideResults")});break;default:e.slideUp("normal",function(){e.remove();LiveSearch.invokeCallbacks("AfterHideResults")})}}};LiveSearch.displayIndicator=function(){if(jQuery(".search_results_activity_indicator").size()===0){var e=jQuery("input:focus").first();var t=e.offset();jQuery("body").append('<span id="search_results_activity_indicator" class="search_results_activity_indicator" />');var n={outer:Math.ceil(e.height()*.9/2)};n.inner=Math.floor(n.outer*.29);jQuery(".search_results_activity_indicator").css("position","absolute").css("z-index",9999);var r=t.top+(e.outerHeight()-e.innerHeight())/2+"px";jQuery(".search_results_activity_indicator").css("top",r);var i=t.left+e.outerWidth()-(n.outer+n.inner)*2-2+"px";jQuery(".search_results_activity_indicator").css("left",i);Spinners.create(".search_results_activity_indicator",{radii:[n.inner,n.outer],color:"#888888",dashWidth:4,dashes:8,opacity:.8,speed:.7}).play()}};LiveSearch.removeIndicator=function(){jQuery(".search_results_activity_indicator").remove()};jQuery(function(){LiveSearch.init()})
